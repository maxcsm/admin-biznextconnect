"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1122],{1122:(S,h,u)=>{u.r(h),u.d(h,{MessagePageModule:()=>s});var b=u(6895),f=u(433),i=u(5035),g=u(4126),c=u(655),e=u(8256),p=u(849),v=u(1053),y=u(529),_=u(7330);const m=function(a){return{"background-image":a}};function P(a,t){if(1&a&&(e.TgZ(0,"div",1),e._UZ(1,"img",29),e._uU(2),e.qZA()),2&a){const r=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(2,m,"url("+r.path+")")),e.xp6(1),e.hij(" ",r.name," ")}}function w(a,t){if(1&a&&(e.TgZ(0,"ion-item",25)(1,"div",26),e._UZ(2,"img",22),e.qZA(),e.TgZ(3,"ion-badge",27),e._uU(4),e.TgZ(5,"ion-note",28)(6,"div"),e.YNc(7,P,3,4,"div",24),e.qZA(),e.TgZ(8,"b"),e._uU(9,"Moi"),e.qZA(),e.TgZ(10,"small"),e._uU(11," le "),e.TgZ(12,"b"),e._uU(13),e.ALo(14,"date"),e.qZA(),e._uU(15," \xe0 "),e.TgZ(16,"b"),e._uU(17),e.ALo(18,"date"),e.qZA()()()()()),2&a){const r=e.oxw().$implicit;e.s9C("href",r.path),e.xp6(2),e.s9C("src",r.user_avatar,e.LSH),e.xp6(2),e.hij(" ",r.body," "),e.xp6(3),e.Q6J("ngIf",null!==r.thumb_path),e.xp6(6),e.Oqu(e.xi3(14,6,r.created_at,"dd/MM/yyyy")),e.xp6(4),e.hij(" ",e.xi3(18,9,r.created_at,"HH:mm")," ")}}function j(a,t){if(1&a&&(e.TgZ(0,"div",1),e._UZ(1,"img",29),e._uU(2),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(2,m,"url(/"+r.thumb_path+")")),e.xp6(1),e.hij(" ",r.name," ")}}function O(a,t){if(1&a&&(e.TgZ(0,"ion-list",18),e.YNc(1,w,19,12,"ion-item",19),e.TgZ(2,"ion-item",20)(3,"div",21),e._UZ(4,"img",22),e.TgZ(5,"small"),e._uU(6),e.qZA()(),e.TgZ(7,"ion-badge",23),e._uU(8),e.TgZ(9,"ion-note",0)(10,"div"),e.YNc(11,j,3,4,"div",24),e.qZA(),e.TgZ(12,"small"),e._uU(13," le "),e.TgZ(14,"b"),e._uU(15),e.ALo(16,"date"),e.qZA(),e._uU(17," \xe0 "),e.TgZ(18,"b"),e._uU(19),e.ALo(20,"date"),e.qZA()()()()()()),2&a){const r=t.$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf",r.from_id==o.iduser),e.xp6(1),e.MGl("href","/",r.path,""),e.Q6J("hidden",o.iduser==r.from_id),e.xp6(2),e.s9C("src",r.user_avatar,e.LSH),e.xp6(2),e.hij(" ",r.firstname," "),e.xp6(2),e.hij(" ",r.body," "),e.xp6(3),e.Q6J("ngIf",null!==r.thumb_path),e.xp6(4),e.Oqu(e.xi3(16,9,r.created_at,"dd/MM/yyyy")),e.xp6(4),e.hij(" ",e.xi3(20,12,r.created_at,"HH:mm")," ")}}class d{constructor(t,r,o,l,T,x,M){Object.defineProperty(this,"route",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"redditService",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"loadingController",{enumerable:!0,configurable:!0,writable:!0,value:l}),Object.defineProperty(this,"http",{enumerable:!0,configurable:!0,writable:!0,value:T}),Object.defineProperty(this,"localStore",{enumerable:!0,configurable:!0,writable:!0,value:x}),Object.defineProperty(this,"router",{enumerable:!0,configurable:!0,writable:!0,value:M}),Object.defineProperty(this,"file",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"category",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"users",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useridmessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"read",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenvalue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"patient_file_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filedata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filedataresp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filedatares",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"myid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"to_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"msg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"from_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"senderid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sender",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"per_page",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"order_id",{enumerable:!0,configurable:!0,writable:!0,value:"id"}),Object.defineProperty(this,"order_by",{enumerable:!0,configurable:!0,writable:!0,value:"asc"}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thread_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"table",{enumerable:!0,configurable:!0,writable:!0,value:"messagesChat"}),Object.defineProperty(this,"table2",{enumerable:!0,configurable:!0,writable:!0,value:"messages"}),Object.defineProperty(this,"table3",{enumerable:!0,configurable:!0,writable:!0,value:"uploadfilemessage"}),Object.defineProperty(this,"usertable",{enumerable:!0,configurable:!0,writable:!0,value:"users"}),Object.defineProperty(this,"chatBox",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"idmessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentpage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"last_page",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"treadstable",{enumerable:!0,configurable:!0,writable:!0,value:"treads"}),Object.defineProperty(this,"idtoken",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"token",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"posts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iduser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messagedata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message_app_user_list",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"patient_file_list",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"app_user_view_list",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"first_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id_message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"iduser_message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}logScrollStart(t){console.log("logScrollStart : When Scroll Starts",t)}logScrolling(t){console.log("logScrolling : When Scrolling",t)}logScrollEnd(t){console.log("logScrollEnd : When Scroll Ends",t)}ScrollToBottom(){this.content.scrollToBottom(1500)}ngOnInit(){this.chatBox="",this.route.params.subscribe(t=>{this.thread_id=t.id})}ionViewWillEnter(){return(0,c.mG)(this,void 0,void 0,function*(){this.iduser=this.localStore.getItem("iduser"),this.getData(),setTimeout(()=>{this.ScrollToBottom()},800)})}getData(){this.redditService.getByid("threads",this.thread_id).subscribe(t=>{console.log(t)}),console.log(this.thread_id),this.page=1,this.redditService.getDataBypageByMessage(this.thread_id,this.page,this.table,this.per_page,this.order_id,this.order_by,this.category,this.status,this.filter).subscribe(t=>{console.log(t),this.posts=t.messages.data.slice().reverse(),this.total=t.messages.total,this.per_page=t.messages.per_page,this.currentpage=t.messages.current_page,this.last_page=t.messages.last_page,setTimeout(()=>{this.ScrollToBottom()},800)})}sendNewMessage(t){var r=JSON.stringify({from_id:this.iduser,to_id:"",body:this.chatBox,thread_id:this.thread_id,type_id:0,depth:1});console.log(r),this.redditService.addPost("messageNew",r).toPromise().then(o=>{console.log(o),this.message_id=o.id,setTimeout(()=>(0,c.mG)(this,void 0,void 0,function*(){this.getData(),this.chatBox=""}),400)})}readmessage(){console.log("READ MESSAGE");var t={token_value:this.token,token_id:this.idtoken,message_id:this.thread_id};console.log(t),this.redditService.readMessage(t).subscribe(r=>{console.log(r)},r=>{console.log(r)})}simpleLoader(){return(0,c.mG)(this,void 0,void 0,function*(){this.loadingController.create({message:"Chargement..."}).then(t=>{t.present()})})}dismissLoader(){return(0,c.mG)(this,void 0,void 0,function*(){this.loadingController.dismiss().then(t=>{console.log("Loader closed!",t)}).catch(t=>{console.log("Error occured : ",t)})})}doRefresh(t){this.currentpage<this.last_page?(this.page=this.page+1,setTimeout(()=>{this.getData(),t.target.complete()},600)):setTimeout(()=>{t.target.complete()},600)}onFileChange(t){this.file=t.target.files[0],this.submitForm()}submitForm(){return(0,c.mG)(this,void 0,void 0,function*(){let t=new FormData;this.http.post("",t).toPromise().then(r=>{console.log(r),this.filedatares=[r],setTimeout(()=>{},800)},r=>{console.log(r)})})}back(){this.router.navigateByUrl("/tabs/chat")}}Object.defineProperty(d,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(t){return new(t||d)(e.Y36(g.gz),e.Y36(p.K),e.Y36(v.I),e.Y36(i.HT),e.Y36(y.eN),e.Y36(_.C),e.Y36(g.F0))}}),Object.defineProperty(d,"\u0275cmp",{enumerable:!0,configurable:!0,writable:!0,value:e.Xpm({type:d,selectors:[["app-message"]],viewQuery:function(t,r){if(1&t&&e.Gf(i.W2,5),2&t){let o;e.iGM(o=e.CRH())&&(r.content=o.first)}},decls:25,vars:3,consts:[["color","primary"],["slot","start"],["text","Mess.",3,"click"],[3,"scrollEvents"],["slot","fixed",3,"ionRefresh"],["justify-content-center",""],["size-md","3","size-lg","3","size-xs","12"],["align-self-center","","size-md","6","size-lg","6","size-xs","12"],["style","padding-top: 3%;","style","padding-bottom: 10px;",4,"ngFor","ngForOf"],[2,"height","200px"],[2,"display","none"],["slot","icon-only","name","attach"],["type","file",3,"change"],["type","text","placeholder","Message...",3,"ngModel","ngModelChange"],["messageInput",""],["slot","end"],["button","","color","primary",3,"click"],["slot","icon-only","name","send"],[2,"padding-bottom","10px"],["lines","none","target","_blank",3,"href",4,"ngIf"],["lines","none","target","_blank",3,"hidden","href"],["slot","start",1,"border-blue"],["width","40px","height","40px",3,"src"],["color","light","slot","start",1,"wrap-text"],["slot","start",4,"ngIf"],["lines","none","target","_blank",3,"href"],["slot","end",1,"border-blue"],["color","primary","slot","end",1,"wrap-text"],["color","primary",2,"color","white"],[1,"circular",3,"ngStyle"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-back-button",2),e.NdJ("click",function(){return r.back()}),e.qZA()(),e._UZ(4,"ion-title"),e.qZA()(),e.TgZ(5,"ion-content",3)(6,"ion-refresher",4),e.NdJ("ionRefresh",function(l){return r.doRefresh(l)}),e._UZ(7,"ion-refresher-content"),e.qZA(),e.TgZ(8,"ion-row",5),e._UZ(9,"ion-col",6),e.TgZ(10,"ion-col",7),e.YNc(11,O,21,15,"ion-list",8),e.qZA(),e._UZ(12,"ion-col",6),e.qZA()(),e.TgZ(13,"ion-footer",9)(14,"ion-item",10)(15,"ion-buttons",1)(16,"ion-button"),e._UZ(17,"ion-icon",11),e.qZA()(),e.TgZ(18,"input",12),e.NdJ("change",function(l){return r.onFileChange(l)}),e.qZA()(),e.TgZ(19,"ion-toolbar")(20,"ion-input",13,14),e.NdJ("ngModelChange",function(l){return r.chatBox=l}),e.qZA(),e.TgZ(22,"ion-buttons",15)(23,"ion-button",16),e.NdJ("click",function(){return r.sendNewMessage(r.chatBox)}),e._UZ(24,"ion-icon",17),e.qZA()()()()),2&t&&(e.xp6(5),e.Q6J("scrollEvents",!0),e.xp6(6),e.Q6J("ngForOf",r.posts),e.xp6(9),e.Q6J("ngModel",r.chatBox))},dependencies:[b.sg,b.O5,b.PC,f.JJ,f.On,i.oU,i.yp,i.YG,i.Sm,i.wI,i.W2,i.fr,i.Gu,i.gu,i.pK,i.Ie,i.q_,i.uN,i.nJ,i.Wo,i.Nd,i.wd,i.sr,i.j9,i.cs,b.uU]})});const Z=[{path:"",component:d}];class n{}Object.defineProperty(n,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(t){return new(t||n)}}),Object.defineProperty(n,"\u0275mod",{enumerable:!0,configurable:!0,writable:!0,value:e.oAB({type:n})}),Object.defineProperty(n,"\u0275inj",{enumerable:!0,configurable:!0,writable:!0,value:e.cJS({imports:[g.Bz.forChild(Z),g.Bz]})});class s{}Object.defineProperty(s,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(t){return new(t||s)}}),Object.defineProperty(s,"\u0275mod",{enumerable:!0,configurable:!0,writable:!0,value:e.oAB({type:s})}),Object.defineProperty(s,"\u0275inj",{enumerable:!0,configurable:!0,writable:!0,value:e.cJS({imports:[b.ez,f.u5,i.Pc,n]})})}}]);